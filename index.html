<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte M√©dico - An√°lisis de Pisada y Presiones Plantares</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="supabase-secrets.js"></script>
    <script>
        // Proteger p√°gina: verificar que est√© logueado
        window.addEventListener('load', () => {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (!isLoggedIn) {
                window.location.href = 'login.html';
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="kinetiq_logo.png" alt="Logo Kinetiq" class="logo">
                </div>
                <div class="title-section">
                    <h1 class="main-title">An√°lisis de Pisada y Presiones Plantares</h1>
                </div>
                <div class="date-section">
                    <p class="report-date" id="reportDate"></p>
                    <a href="reportes.html" style="color: white; font-size: 12px; text-decoration: none; opacity: 0.8;">üìã Mis Reportes</a>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <form id="reportForm" class="form-container">

                <!-- SECCI√ìN 1: DATOS GENERALES -->
                <section class="section">
                    <div class="section-header">
                        <h2>DATOS GENERALES</h2>
                    </div>

                    <div class="section-content">
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label for="nombre">Nombre:</label>
                                <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Ingrese nombre">
                            </div>
                            <div class="form-group">
                                <label for="apellido">Apellido:</label>
                                <input type="text" id="apellido" name="apellido" class="form-control" placeholder="Ingrese apellido">
                            </div>
                        </div>

                        <div class="form-grid-4">
                            <div class="form-group">
                                <label for="edad">Edad:</label>
                                <input type="number" id="edad" name="edad" class="form-control" min="0" max="120" placeholder="a√±os">
                            </div>
                            <div class="form-group">
                                <label for="peso">Peso (kg):</label>
                                <input type="number" id="peso" name="peso" class="form-control" min="20" step="0.1" placeholder="kg">
                            </div>
                            <div class="form-group">
                                <label for="sexo">Sexo:</label>
                                <select id="sexo" name="sexo" class="form-control">
                                    <option value="">Seleccione...</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="No especificado">No especificado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cc">CC:</label>
                                <input type="text" id="cc" name="cc" class="form-control" placeholder="C√©dula">
                            </div>
                        </div>

                        <div class="form-grid-4">
                            <div class="form-group">
                                <label for="talla">Talla (cm):</label>
                                <input type="number" id="talla" name="talla" class="form-control" min="50" step="0.1" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="dominancia">Dominancia:</label>
                                <select id="dominancia" name="dominancia" class="form-control">
                                    <option value="">Seleccione...</option>
                                    <option value="Derecha">Derecha</option>
                                    <option value="Izquierda">Izquierda</option>
                                    <option value="Ambidiestro">Ambidiestro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="imc">IMC:</label>
                                <input type="number" id="imc" name="imc" class="form-control" readonly placeholder="C√°lculo autom√°tico">
                            </div>
                            <div class="form-group">
                                <label for="celular">Celular:</label>
                                <input type="tel" id="celular" name="celular" class="form-control" placeholder="10 d√≠gitos">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECCI√ìN 2: ANAMNESIS Y ANTECEDENTES CL√çNICOS -->
                <section class="section">
                    <div class="section-header">
                        <h2>ANAMNESIS Y ANTECEDENTES CL√çNICOS</h2>
                    </div>

                    <div class="antecedents-grid">
                        <div class="form-group">
                            <label for="antecMedicos">Antecedentes m√©dicos:</label>
                            <textarea id="antecMedicos" name="antecMedicos" class="form-control textarea" rows="3" placeholder="Ingrese los antecedentes m√©dicos..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="antecQuirurgicos">Antecedentes quir√∫rgicos:</label>
                            <textarea id="antecQuirurgicos" name="antecQuirurgicos" class="form-control textarea" rows="3" placeholder="Ingrese los antecedentes quir√∫rgicos..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="antecLesiones">Antecedentes de lesiones:</label>
                            <textarea id="antecLesiones" name="antecLesiones" class="form-control textarea" rows="3" placeholder="Ingrese los antecedentes de lesiones..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="antecTrauma">Antecedentes traum√°ticos:</label>
                            <textarea id="antecTrauma" name="antecTrauma" class="form-control textarea" rows="3" placeholder="Ingrese los antecedentes traum√°ticos..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="antecMetabolico">Antecedentes metab√≥licos:</label>
                            <textarea id="antecMetabolico" name="antecMetabolico" class="form-control textarea" rows="3" placeholder="Ingrese los antecedentes metab√≥licos..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="hospitalizaciones">Hospitalizaciones:</label>
                            <textarea id="hospitalizaciones" name="hospitalizaciones" class="form-control textarea" rows="2" placeholder="Ingrese informaci√≥n de hospitalizaciones..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="alergias">Alergias:</label>
                            <textarea id="alergias" name="alergias" class="form-control textarea" rows="2" placeholder="Ingrese alergias conocidas..."></textarea>
                        </div>
                    </div>
                </section>

                <!-- SECCI√ìN 3: ACTIVIDAD F√çSICA Y ENTRENAMIENTO -->
                <section class="section">
                    <div class="section-header">
                        <h2>ACTIVIDAD F√çSICA Y ENTRENAMIENTO</h2>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="deporte">Actividad / Deporte:</label>
                            <input type="text" id="deporte" name="deporte" class="form-control" placeholder="Ej. F√∫tbol">
                        </div>
                        <div class="form-group">
                            <label for="tiempoDeporte">Tiempo en el deporte:</label>
                            <input type="text" id="tiempoDeporte" name="tiempoDeporte" class="form-control" placeholder="Ej. 8 a√±os">
                        </div>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="rol">Rol en el deporte:</label>
                            <input type="text" id="rol" name="rol" class="form-control" placeholder="Ej. Mediocampista">
                        </div>
                        <div class="form-group">
                            <label for="club">Club:</label>
                            <input type="text" id="club" name="club" class="form-control" placeholder="Nombre del club">
                        </div>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="entrenador">Entrenador:</label>
                            <input type="text" id="entrenador" name="entrenador" class="form-control" placeholder="Nombre del entrenador">
                        </div>
                        <div class="form-group">
                            <label for="diasEntrenamiento">D√≠as de entrenamientos:</label>
                            <input type="text" id="diasEntrenamiento" name="diasEntrenamiento" class="form-control" placeholder="Ej. 5 d√≠as">
                        </div>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="diasGimnasio">D√≠as de gimnasio:</label>
                            <input type="text" id="diasGimnasio" name="diasGimnasio" class="form-control" placeholder="Ej. 3 d√≠as">
                        </div>
                        <div class="form-group">
                            <label for="diasDescanso">D√≠as de descanso:</label>
                            <input type="text" id="diasDescanso" name="diasDescanso" class="form-control" placeholder="Ej. 1 d√≠a">
                        </div>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="tenis">Tenis que usa:</label>
                            <input type="text" id="tenis" name="tenis" class="form-control" placeholder="Ej. Nike Pegasus">
                        </div>
                        <div class="form-group">
                            <label for="competencia">Carrera/Competencia preparando:</label>
                            <input type="text" id="competencia" name="competencia" class="form-control" placeholder="Ej. Marat√≥n de Bogot√°">
                        </div>
                    </div>
                </section>

                <!-- SECCI√ìN 4: MOTIVO DE CONSULTA -->
                <section class="section">
                    <div class="section-header">
                        <h2>MOTIVO DE CONSULTA</h2>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="motivoConsulta">Motivo de consulta:</label>
                            <textarea id="motivoConsulta" name="motivoConsulta" class="form-control textarea" rows="4" placeholder="Describa el motivo principal de la consulta..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="notasAdicionales">Notas adicionales:</label>
                            <textarea id="notasAdicionales" name="notasAdicionales" class="form-control textarea" rows="4" placeholder="Ingrese notas adicionales..."></textarea>
                        </div>
                    </div>
                </section>

                <!-- SECCI√ìN 5: VALORACI√ìN FISIOTERAPIA DEPORTIVA -->
                <section class="section">
                    <div class="section-header">
                        <h2>VALORACI√ìN FISIOTERAPIA DEPORTIVA</h2>
                    </div>

                    <div class="form-group">
                        <label for="postura">Postura:</label>
                        <textarea id="postura" name="postura" class="form-control textarea" rows="3" placeholder="Describa la valoraci√≥n postural..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="marcha">Marcha:</label>
                        <textarea id="marcha" name="marcha" class="form-control textarea" rows="3" placeholder="Describa la valoraci√≥n de la marcha..."></textarea>
                    </div>

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="hods">HODS:</label>
                            <select id="hods" name="hods" class="form-control">
                                <option value="">Seleccione...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="lunge">Lunge:</label>
                            <select id="lunge" name="lunge" class="form-control">
                                <option value="">Seleccione...</option>
                                <option value="+">+</option>
                                <option value="-">-</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="observaciones">Observaciones:</label>
                        <textarea id="observaciones" name="observaciones" class="form-control textarea" rows="3" placeholder="Ingrese observaciones adicionales..."></textarea>
                    </div>
                </section>

                <!-- SECCI√ìN 9: TESTS DE SALTO -->
                <section class="section">
                    <div class="section-header">
                        <h2>TESTS DE SALTO</h2>
                    </div>

                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Salto</th>
                                    <th>Peso</th>
                                    <th>Altura</th>
                                    <th>Velocidad</th>
                                    <th>Tiempo Vuelo</th>
                                    <th>Q</th>
                                    <th>Ca√≠da</th>
                                    <th>N</th>
                                    <th>RFD</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>CMJ</strong></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="peso" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="altura" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="velocidad" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="tiempoVuelo" step="0.001"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="q" step="0.01"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="caida" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="n" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj" data-col="rfd" step="1"></td>
                                </tr>
                                <tr>
                                    <td><strong>SJ</strong></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="peso" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="altura" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="velocidad" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="tiempoVuelo" step="0.001"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="q" step="0.01"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="caida" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="n" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="sj" data-col="rfd" step="1"></td>
                                </tr>
                                <tr>
                                    <td><strong>DJ</strong></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="peso" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="altura" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="velocidad" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="tiempoVuelo" step="0.001"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="q" step="0.01"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="caida" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="n" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="dj" data-col="rfd" step="1"></td>
                                </tr>
                                <tr>
                                    <td><strong>Abralakov</strong></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="peso" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="altura" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="velocidad" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="tiempoVuelo" step="0.001"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="q" step="0.01"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="caida" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="n" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="abralakov" data-col="rfd" step="1"></td>
                                </tr>
                                <tr>
                                    <td><strong>CMJ 1-1</strong></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="peso" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="altura" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="velocidad" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="tiempoVuelo" step="0.001"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="q" step="0.01"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="caida" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="n" step="0.1"></td>
                                    <td><input type="number" class="salto-input" data-salto="cmj1-1" data-col="rfd" step="1"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- SECCI√ìN: ADJUNTOS (PDF/IMAGEN) -->
                <section class="section">
                    <div class="section-header">
                        <h2>ADJUNTOS (OPCIONAL)</h2>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="pdfImagenInput">Adjuntar PDF o Imagen:</label>
                            <div class="file-upload-card">
                                <input type="file" id="pdfImagenInput" accept=".pdf,.jpg,.jpeg,.png,.gif" class="file-upload-input" aria-label="Adjuntar PDF o imagen" multiple>
                                <label for="pdfImagenInput" class="file-upload-label">
                                    <div class="file-upload-icon">üìé</div>
                                    <div class="file-upload-text">
                                        <strong>Sube tu archivo</strong>
                                        <span>PDF, JPG, PNG o GIF ¬∑ M√°x. 10MB</span>
                                    </div>
                                    <div class="file-upload-cta">Explorar</div>
                                </label>
                            </div>
                            <div id="adjuntoInfo" style="margin-top: 10px; padding: 10px; background: #f0f4f8; border-radius: 6px; display: none;">
                                <p style="margin: 0; color: #333;"><strong>Archivo adjunto:</strong> <span id="adjuntoNombre"></span></p>
                                <p style="margin: 5px 0 0 0; color: #666; font-size: 12px;">Este archivo se agregar√° al PDF cuando descargues el reporte.</p>
                            </div>
                        </div>
                    </div>
                </section>



            </form>
        </main>

        <!-- FOOTER -->
        <footer class="footer">
            <p>&copy; KinetiqSports. Reporte M√©dico Digital. Dise√±ado para profesionales de la salud.</p>
        </footer>
    </div>

    <!-- Input oculto para cargar archivos -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <!-- Modal de confirmaci√≥n -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">üìÑ</div>
            <h2 class="modal-title">¬øDescargar y Guardar Reporte?</h2>
            <p class="modal-message">
                Se descargar√° el PDF y los datos del paciente se guardar√°n en la base de datos de forma segura.
            </p>
            <div class="modal-loading">
                <div class="spinner"></div>
                <p style="color: #7f8c8d;">Guardando datos...</p>
            </div>
            <div class="modal-buttons">
                <button id="modalCancel" class="modal-btn modal-btn-cancel">Cancelar</button>
                <button id="modalConfirm" class="modal-btn modal-btn-confirm">S√≠, Guardar</button>
            </div>
        </div>
    </div>

    <!-- BARRA LATERAL FLOTANTE CON BOTONES DE ACCI√ìN -->
    <div class="floating-sidebar">
        <button type="reset" form="reportForm" class="action-button neutral" title="Limpiar formulario">
            <span style="font-size: 28px;">üîÑ</span>
            <div class="action-button-label">Limpiar</div>
        </button>
        <button type="button" id="loadFileBtn" class="action-button" title="Cargar reporte anterior">
            <span style="font-size: 28px;">üì•</span>
            <div class="action-button-label">Cargar</div>
        </button>
        <button type="button" id="saveBtn" class="action-button success" title="Guardar en la base de datos">
            <span style="font-size: 28px;">üíæ</span>
            <div class="action-button-label">Guardar</div>
        </button>
        <button type="button" id="printBtn" class="action-button info" title="Descargar PDF y guardar">
            <span style="font-size: 28px;">üìÑ</span>
            <div class="action-button-label">Descargar</div>
        </button>
        <a href="bienvenida.html" class="action-button warning" title="Volver a la p√°gina de inicio">
            <span style="font-size: 28px;">üè†</span>
            <div class="action-button-label">Inicio</div>
        </a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="supabase-config.js"></script>
    <script src="data.js"></script>
    <script src="script.js"></script>
</body>
</html>
